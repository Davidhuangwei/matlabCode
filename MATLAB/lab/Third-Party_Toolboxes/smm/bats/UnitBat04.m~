analDirs = {...
    '/BEEF01/smm/sm9601_Analysis/2-16-04/analysis/',...
    '/BEEF01/smm/sm9603_Analysis/3-21-04/analysis/',...
    '/BEEF02/smm/sm9608_Analysis/7-17-04/analysis/',...
    '/BEEF02/smm/sm9614_Analysis/4-17-05/analysis/',...
    }

for j=1:length(analDirs)
    cd(analDirs{j})
    fileBaseCell = [LoadVar('FileInfo/MazeFiles');LoadVar('FileInfo/RemFiles')];
    SumUnitCCGTimeLim01(fileBaseCell,...
        'RemVsRun03_noExp_MinSpeed5wavParam6Win1250.eeg/',250,'scale',3)
    SumUnitCCGTimeLim01(fileBaseCell,...
        'RemVsRun03_noExp_MinSpeed5wavParam6Win1250.eeg/',25,'scale',3)
    SumUnitCCGTimeLim01(fileBaseCell,...
        'RemVsRun03_noExp_MinSpeed5wavParam6Win1250.eeg/',8,'scale',3)
end
for j=1:length(analDirs)
    cd(analDirs{j})
    fileBaseCell = [LoadVar('FileInfo/MazeFiles');LoadVar('FileInfo/RemFiles')];
    MeanUnitCCGTimeLim01(fileBaseCell,...
        'RemVsRun03_noExp_MinSpeed5wavParam6Win1250.eeg/',250,'scale',3)
    MeanUnitCCGTimeLim01(fileBaseCell,...
        'RemVsRun03_noExp_MinSpeed5wavParam6Win1250.eeg/',25,'scale',3)
    MeanUnitCCGTimeLim01(fileBaseCell,...
        'RemVsRun03_noExp_MinSpeed5wavParam6Win1250.eeg/',8,'scale',3)
end


analRoutine = {...
                'MazeAll',...
                'TonicVsMaze_MolSD2',...
                'RemVsMaze_Serial',...
                'PhasicVsTonicVsMaze_MolSD2',...

     'AlterGood_MRrctg',...
     'AlterGood_MRcVrtg',...
     'AlterGood_MRrdctg',...
     'MazeCenter_TT',...
     'ControlGood_MRrctg',...
     'MazeNoDANoWP_Sp0_Ap0',...
}


spectAnalBase = 'RemVsRun07_noExp_MinSpeed5wavParam6Win1250';
spectAnalBase = 'CalcRunningSpectra12_noExp_MidPoints_MinSpeed0Win626wavParam4';
fileExtCell = {...
     '.eeg',...
    '_LinNearCSD121.csd',...
    }
cellRateMin = 5;
trialRateMin = 4;
freqLim = 140;
timeLim = 24;

nTapersCell = {...
     3,...
   5,...
   9,...
   11,...
    19,...
    }
statsAnalFunc = 'GlmWholeModel08';
freqRangeCell = {...
    {[6 12]},...
    {[4 12]},...
    {[40 120]},...
    }
normalizationCell = {...
    'hz',...
    'count',...
    'scale',...
    }
binSizeCell = {...
    1,...
    2,...
     4,...
   6,...
    8,...
    }
biasCorrBool = 0;
biasCorrBool = 1;
rateMin = 0.1;
rateMin = 0.2;
rateMin = 0.5;
% rateMin = 5;
% timeRangeCell = {...
%     [-8 8],...
%     [-25 25],...
%     [-250 250]...
%     }
timeRangeCell = {...
    {[-8 8]},...
    {[-25 -8],[8 25]},...
    {[-250 -83],[83  250]}...
    }
timeRangeCell = {...
    {[0 6]},...
    }
cohName = 'orig';
saveDir = '/u12/smm/public_html/NewFigs/ThetaPaper/UnitAnal16/';
saveDir = '/u12/smm/public_html/NewFigs/ThetaPaper/UnitAnal15/';
saveDir = '/u12/smm/public_html/NewFigs/ThetaPaper/UnitAnal15/sm9601/';
saveDir = '/u12/smm/public_html/NewFigs/ThetaPaper/UnitAnal15/sm9603/';
saveDir = '/u12/smm/public_html/NewFigs/ThetaPaper/UnitAnal15/sm9608/';
saveDir = '/u12/smm/public_html/NewFigs/ThetaPaper/UnitAnal15/sm9614/';
reportFigBool = ...
    0
    1
for m=1:length(analRoutine)
    PlotUnitRatesScat07(analDirs,[spectAnalBase '.eeg'],statsAnalFunc,analRoutine{m},reportFigBool,saveDir)
    PlotUnitRatesScat06_fig(analDirs,[spectAnalBase '.eeg'],statsAnalFunc,analRoutine{m},reportFigBool,saveDir)
    for j=1:length(nTapersCell)
        PlotUnitSpectrum06(analDirs,[spectAnalBase '.eeg'],statsAnalFunc,...
            analRoutine{m},trialRateMin,cellRateMin,nTapersCell{j},...
            freqLim,freqRangeCell,reportFigBool,saveDir)
        PlotUnitSpectrum05fig(analDirs,[spectAnalBase '.eeg'],statsAnalFunc,...
            analRoutine{m},trialRateMin,cellRateMin,nTapersCell{j},...
            freqLim,freqRangeCell,reportFigBool,saveDir)
        
        for k=1:length(fileExtCell)
            PlotUnitFieldCoh08(analDirs,fileExtCell{k},[spectAnalBase fileExtCell{k}],statsAnalFunc,...
                analRoutine{m},freqLim,trialRateMin,cellRateMin,cohName,nTapersCell{j},freqRangeCell,reportFigBool,saveDir)
            PlotUnitFieldCoh07fig(analDirs,fileExtCell{k},[spectAnalBase fileExtCell{k}],statsAnalFunc,...
                analRoutine{m},freqLim,trialRateMin,cellRateMin,cohName,nTapersCell{j},freqRangeCell,reportFigBool,saveDir)
            
            PlotUnitFieldPhase05(analDirs,fileExtCell{k},[spectAnalBase fileExtCell{k}],statsAnalFunc,...
                analRoutine{m},freqLim,trialRateMin,cellRateMin,nTapersCell{j},freqRangeCell,reportFigBool,saveDir)
            PlotUnitFieldThetaPeakPhase07(analDirs,fileExtCell{k},[spectAnalBase fileExtCell{k}],statsAnalFunc,...
                analRoutine{m},freqLim,trialRateMin,cellRateMin,nTapersCell{j},freqRangeCell,reportFigBool,saveDir)
        end
    end
    for k=1:length(binSizeCell)
        PlotUnitISIDist01(analDirs,[spectAnalBase '.eeg'],statsAnalFunc,...
            analRoutine{m},binSizeCell{k},timeLim,...
            rateMin,timeRangeCell,reportFigBool,saveDir)

        for j=1:length(normalizationCell)
            PlotUnitCCG05(analDirs,[spectAnalBase '.eeg'],statsAnalFunc,...
                analRoutine{m},normalizationCell{j},binSizeCell{k},timeLim,...
                biasCorrBool,rateMin,timeRangeCell,reportFigBool,saveDir)
            PlotUnitCCG06(analDirs,[spectAnalBase '.eeg'],statsAnalFunc,...
                analRoutine{m},normalizationCell{j},binSizeCell{k},timeLim,...
                biasCorrBool,trialRateMin,cellRateMin,timeRangeCell,reportFigBool,saveDir)
            
             PlotUnitCCG05fig(analDirs,[spectAnalBase '.eeg'],statsAnalFunc,...
                analRoutine{m},normalizationCell{j},binSizeCell{k},timeLim,...
                biasCorrBool,rateMin,timeRangeCell,reportFigBool,saveDir)
           PlotUnitCCG06fig(analDirs,[spectAnalBase '.eeg'],statsAnalFunc,...
                analRoutine{m},normalizationCell{j},binSizeCell{k},timeLim,...
                biasCorrBool,trialRateMin,cellRateMin,timeRangeCell,reportFigBool,saveDir)
        end
    end
end
spectAnalBase = 'RemVsRun07_noExp_MinSpeed5wavParam6Win1250';
fileExtCell = {...
    '.eeg',...
    '_LinNearCSD121.csd',...
    }
cellRateMin = 7;
trialRateMin = 5;
freqLim = 200;
timeLim = 250;

nTapersCell = {...
    5,...
    9,...
    11,...
   19,...
    }
statsAnalFunc = 'GlmWholeModel08';
freqRangeCell = {...
    [4 12],...
    [40 120],...
    }
normalizationCell = {...
    'count',...
%     'scale',...
    }
binSizeCell = {...
    4,...
    8,...
    }
biasCorrBool = 1;
rateMin = 0.05;
timeRangeCell = {...
    [-8 8],...
    [-25 25],...
    [-250 250]...
    }
cohName = 'orig';
saveDir = '/u12/smm/public_html/NewFigs/REMPaper/UnitFieldMetaAnal/';
for m=1:length(analRoutine)
    ExtractUnitRatesScat06(analDirs,[spectAnalBase '.eeg'],statsAnalFunc,analRoutine{m},1,saveDir)
    for j=1:length(nTapersCell)
        ExtractUnitSpectrum05(analDirs,[spectAnalBase '.eeg'],statsAnalFunc,...
            analRoutine{m},trialRateMin,cellRateMin,nTapersCell{j},...
            freqLim,freqRangeCell,1,saveDir)
        for k=1:length(fileExtCell)
            ExtractUnitFieldCoh07(analDirs,fileExtCell{k},[spectAnalBase fileExtCell{k}],statsAnalFunc,...
                analRoutine{m},freqLim,trialRateMin,cellRateMin,cohName,nTapersCell{j},freqRangeCell,1,saveDir)
        end
    end
    for j=1:length(normalizationCell)
        for k=1:length(binSizeCell)
            ExtractUnitCCG05(analDirs,[spectAnalBase '.eeg'],statsAnalFunc,...
                analRoutine{m},normalizationCell{j},binSizeCell{k},timeLim,...
                biasCorrBool,rateMin,timeRangeCell,1,saveDir)
        end
    end
end


analRoutine = {'PhasicVsTonicVsMaze_MolSD2'}
timeLim = 200;
spectAnalDir = 'RemVsRun07_noExp_MinSpeed5wavParam6Win1250.eeg';
statsAnalFunc = 'GlmWholeModel08';
normalizationCell = {...
    'count',...
    'scale',...
    }
binSizeCell = {...
    4,...
    8,...
    }
biasCorrBool = 1;
rateMin = 0.05;
timeRangeCell = {...
    [-8 8],...
    [-25 25],...
    [-250 250]...
    }
saveDir = '/u12/smm/public_html/NewFigs/REMPaper/UnitAnal06/';
for m=1:length(analRoutine)
    PlotUnitRatesScat06(analDirs,spectAnalDir,statsAnalFunc,analRoutine{m},1,saveDir)
    for j=1:length(normalizationCell)
        for k=1:length(binSizeCell)
            PlotUnitCCG05(analDirs,spectAnalDir,statsAnalFunc,...
                analRoutine{m},normalizationCell{j},binSizeCell{k},timeLim,...
                biasCorrBool,rateMin,timeRangeCell,1,saveDir)
        end
    end
end


analRoutine = {'PhasicVsTonicVsMaze_MolSD2'}
spectAnalBase = 'RemVsRun07_noExp_MinSpeed5wavParam6Win1250';
fileExtCell = {...
    '.eeg',...
    '_LinNearCSD121.csd',...
    }
cellRateMin = 7;
trialRateMin = 5;
% cellRateMin = 5;
% trialRateMin = 4;
freqLim = 200;
nTapersCell = {...
    5,...
    19,...
    }
statsAnalFunc = 'GlmWholeModel08';
cohName = 'orig';
saveDir = '/u12/smm/public_html/NewFigs/REMPaper/UnitAnal06/';
% cohName = '';
freqRangeCell = {...
    [4 12],...
    [40 120],...
    }
for m=1:length(analRoutine)
    for j=1:length(nTapersCell)
        for k=1:length(fileExtCell)
            PlotUnitFieldCoh07(analDirs,fileExtCell{k},[spectAnalBase fileExtCell{k}],statsAnalFunc,...
                analRoutine{m},freqLim,trialRateMin,cellRateMin,cohName,nTapersCell{j},freqRangeCell,1,saveDir)

            PlotUnitFieldPhase04(analDirs,fileExtCell{k},[spectAnalBase fileExtCell{k}],statsAnalFunc,...
                analRoutine{m},freqLim,trialRateMin,cellRateMin,nTapersCell{j},freqRangeCell,1,saveDir)
        end
    end
end

analRoutine = {'PhasicVsTonicVsMaze_MolSD2'}
spectAnalDir = 'RemVsRun07_noExp_MinSpeed5wavParam6Win1250.eeg/';
% analRoutine = 'RemVsMaze_Beh'
statsAnalFunc = 'GlmWholeModel08';
freqLim = 200;
cellRateMin = 7;
trialRateMin = 5;
% cellRateMin = 5;
% trialRateMin = 4;
% rateMin = 0.05;
nTapersCell = {...
    5,...
    19,...
    }
freqRangeCell = {...
    [4 12],...
    [40 120],...
    }
saveDir = '/u12/smm/public_html/NewFigs/REMPaper/UnitAnal06/';
for j=1:length(nTapersCell)
    for m=1:length(analRoutine)
        PlotUnitSpectrum05(analDirs,spectAnalDir,statsAnalFunc,...
            analRoutine{m},trialRateMin,cellRateMin,nTapersCell{j},...
            freqLim,freqRangeCell,1,saveDir)
    end
end

for n=1:length(spectAnalBase)
    for m=1:length(analRoutine)
        for j=1:length(fileExtCell)
            for k=1:length(analDirs)
                cd(analDirs{k})
%                  try
                    GlmWholeAnalysisBatch08(spectAnalBase{n},analRoutine{m},'01',fileExtCell{j},depVarCell)
%                     GlmWholeAnalysisBatch07('RemVsRun01_noExp',analRoutine{m},'01',fileExtCell{j},depVarCell,[],0,0,1250,1)
%                  catch
%                      ReportError(['ERROR:  ' date '  GLMbat02bat  ' analDirs{k}  spectAnalBase{n}  fileExtCell{j} '  ' analRoutine{m} '\n']);
%                  end
             end
        end
    end
end


fileExtCell = {
    '.eeg',...
    '_LinNearCSD121.csd',...
    };
winLen = 626;
spectAnalBase = 'RemVsRun07_noExp_MinSpeed5wavParam6Win1250';
spectAnalBase = 'CalcRunningSpectra12_noExp_MidPoints_MinSpeed0Win626wavParam4';
nwTapersCell = {...
    [2 3],...
    [3 5],...
    [5 9],...
    [6 11],...
    [10 19],...
    };
for m=1:length(nwTapersCell)
    for k=1:length(fileExtCell)
        for j=1:length(analDirs)
            cd(analDirs{j})
%             fileBaseCell = [LoadVar('FileInfo/RemFiles');LoadVar('FileInfo/MazeFiles')];
%             fileBaseCell = [LoadVar('FileInfo/RemFiles')];
    fileBaseCell = LoadVar('FileInfo/MazeFiles');
    nChan = load(['ChanInfo/NChan' fileExtCell{k} '.txt']);
%             CalcUnitFieldCoh06(fileBaseCell,fileExtCell{k},winLen,SC([spectAnalBase fileExtCell{k}]),[],[0 200],nwTapersCell{m})
            CalcUnitFieldCohAll06(fileBaseCell,fileExtCell{k},winLen,SC([spectAnalBase fileExtCell{k}]),[1:nChan],[0 200],nwTapersCell{m})
        end
    end
end
fileExt = '.eeg'
for m=1:length(nwTapersCell)
        for j=1:length(analDirs)
            cd(analDirs{j})
%             fileBaseCell = [LoadVar('FileInfo/RemFiles');LoadVar('FileInfo/MazeFiles')];
%             fileBaseCell = [LoadVar('FileInfo/RemFiles')];
    fileBaseCell = LoadVar('FileInfo/MazeFiles');
            CalcUnitSpectrum03(fileBaseCell,winLen,SC([spectAnalBase fileExt]),nwTapersCell{m},1024)
        end
end

addpath /u12/antsiro/matlab/draft/  
binsCell = {...
    [1 50]
    [2 25]
%     [4 85],...
    [8 43],...
    [6 57],...
    }
normCell = {...
    'count',...
    'hz',...
    'hz2',...
   'scale',...
    }
biasCorrectBool = ...
    1
    0
spectAnalDir = 'RemVsRun07_noExp_MinSpeed5wavParam6Win1250.eeg/'  % CalcRunningSpectra15 & CalcRemSpectra06
for m=1:length(normCell)
    for k=1:length(binsCell)
        for j=1:length(analDirs)
            cd(analDirs{j})
            fileBaseCell = [LoadVar('FileInfo/RemFiles');LoadVar('FileInfo/MazeFiles')];
            %     fileBaseCell = [LoadVar('FileInfo/RemFiles')];
            %     CalcUnitCCG04(fileBaseCell,1250,'RemVsRun03_noExp_MinSpeed5wavParam6Win1250.eeg/',...
            %         'count',8,62,1)
            CalcUnitCCG04(fileBaseCell,1250,spectAnalDir,...
                normCell{m},binsCell{k}(1),binsCell{k}(2),biasCorrectBool)
            
            CalcUnitISIDist02(fileBaseCell,1250,spectAnalDir,...
                binsCell{k}(1),binsCell{k}(2))
            %     CalcUnitCCG04(fileBaseCell,1250,'RemVsRun03_noExp_MinSpeed5wavParam6Win1250.eeg/',...
            %         'scale',8,62,1)
            %         CalcUnitCCG04(fileBaseCell,1250,spectAnalDir,...
            %             'scale',binsCell{k}(1),binsCell{k}(2),1)
        end
    end
end

for j=1:length(analDirs)
    cd(analDirs{j})
    fileBaseCell = [LoadVar('FileInfo/RemFiles');LoadVar('FileInfo/MazeFiles')];

    CalcUnitISIDist02(fileBaseCell,1250,spectAnalDir,...
        binsCell{k}(1),binsCell{k}(2))
end

fileExt = '.eeg';
fileExt = '_LinNearCSD121.csd';
winLen = 626;
spectAnalDir = 'CalcRunningSpectra12_noExp_MidPoints_MinSpeed0Win626wavParam4';
for j=1:length(analDirs)
    cd(analDirs{j})
%     fileBaseCell = [LoadVar('FileInfo/MazeFiles');LoadVar('FileInfo/RemFiles')];
    fileBaseCell = LoadVar('FileInfo/MazeFiles');
    CalcUnitRates05(fileBaseCell,fileExt,winLen,SC([spectAnalDir fileExt]))
end

for j=1:length(analDirs)
    cd(analDirs{j})

    remFiles = LoadVar('FileInfo/RemFiles')
    CalcRemMeasTimes01('CalcRemSpectra04','allTimes',remFiles,'.eeg',97,1250,6)

    mazeFiles = LoadVar('FileInfo/MazeFiles')
    CalcMazeMeasTimes01('CalcRunningSpectra12','noExp',mazeFiles,'.eeg',97,1250,6,0)
end

MakeRemVsRunLinks(analDirs,{'.eeg'})


for j=1:length(analDirs)
    cd(analDirs{j})
    files = [LoadVar('FileInfo/MazeFiles')];
   %CalcUnitPopACG05(files,626,'CalcRunningSpectra12_noExp_MidPoints_MinSpeed0Win626wavParam8.eeg/',3,'count')
   %CalcUnitPopSpectrum02(files,626,'CalcRunningSpectra12_noExp_MidPoints_MinSpeed0Win626wavParam8.eeg/',2)
   %CalcUnitPopFieldCoh02(files,626,'.eeg','CalcRunningSpectra12_noExp_MidPoints_MinSpeed0Win626wavParam8',2)
   CalcUnitPopFieldCoh02(files,626,'_LinNearCSD121.csd','CalcRunningSpectra12_noExp_MidPoints_MinSpeed0Win626wavParam8',2)
end

for j=1:length(analDirs)
    cd(analDirs{j})
    files = [LoadVar('FileInfo/RemFiles');LoadVar('FileInfo/MazeFiles')];
%    CalcUnitACG02(files,1250,'RemVsRun02_noExp_MinSpeed0Win1250wavParam6.eeg/')
   CalcUnitPopACG05(files,1250,'RemVsRun02_noExp_MinSpeed0Win1250wavParam6.eeg/',3)
     %CalcUnitPopSpectrum02(files,1250,'RemVsRun02_noExp_MinSpeed0Win1250wavParam6.eeg/',10)
end

TrialDesigLists07({'RemVsMaze_Beh'})


analDirs = {...
    '/BEEF01/smm/sm9603_Analysis/3-21-04/analysis/',...
    '/BEEF02/smm/sm9608_Analysis/7-17-04/analysis/',...
    '/BEEF02/smm/sm9614_Analysis/4-17-05/analysis/',...
    }
trialTypesBool = [];
trialTypesBool.AllTrials = [1 1 1 1 1 1 1 1 1 1 1 1 1];
trialTypesBool.GoodTrials = [1 0 1 0 0 0 0 0 0 0 0 0 0];
trialTypesBool.AllCorrect = [1 0 1 0 1 0 1 0 1 0 1 0 0];
trialTypesBool.AllIncorrect = [0 1 0 1 0 1 0 1 0 1 0 1 0];
numFigs = length(fieldnames(trialTypesBool));
for j=1:length(analDirs)
    cd(analDirs{j})
    alterFiles = LoadVar('FileInfo/AlterFiles');
    PlotPopPlaceFields02(alterFiles,trialTypesBool)
    ReportFigSM([1:numFigs],[analDirs{j} 'NewFigs/PFPlots/'],repmat({'alterPop'},numFigs,1));
    close all
end

trialTypesBool = [];
trialTypesBool.AllTrials = [1 1 1 1 1 1 1 1 1 1 1 1 1];
trialTypesBool.GoodTrials = [1 0 1 0 0 0 0 0 0 0 0 0 0];
trialTypesBool.LRGood = [1 0 0 0 0 0 0 0 0 0 0 0 0];
trialTypesBool.RLGood = [0 0 1 0 0 0 0 0 0 0 0 0 0];
numFigs = length(fieldnames(trialTypesBool));
for j=1:length(analDirs)
    cd(analDirs{j})
    alterFiles = LoadVar('FileInfo/AlterFiles');
    mazeFiles = LoadVar('FileInfo/MazeFiles');
    PlotPopPlaceFields02(setdiff(mazeFiles,alterFiles),trialTypesBool)
    ReportFigSM([1:numFigs],[analDirs{j} 'NewFigs/PFPlots/'],repmat({'controlPop'},numFigs,1));
    close all
end

% LR RR RL LL LRP RRP RLP LLP LRB RRB RLB LLB XP

